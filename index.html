<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>News mit Matrix + Swipeable Nav</title>
<style>
body { margin:0; font-family:sans-serif; height:100vh; overflow:hidden; background:#000; }
canvas#matrixCanvas { position:fixed; top:0; left:0; width:100%; height:100%; z-index:0; background:black; }

.overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(18,18,18,0.85); backdrop-filter:blur(2px); z-index:1; display:flex; flex-direction:column; justify-content:flex-end; }
.content-wrapper { flex-grow:1; display:flex; overflow:hidden; }
.tab-content { flex:0 0 100%; overflow-y:auto; padding:12em 1em 12em 1em; box-sizing:border-box; display:none; color:white; }
.tab-content.active { display:block; }

a { color:#03a9f4; text-decoration:none; display:block; margin:0.5em 0; }
a:hover { text-decoration:underline; }

.nav-button { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); width:60px; height:60px; border-radius:50%; background:rgba(3,218,198,0.7); display:flex; align-items:center; justify-content:center; cursor:pointer; z-index:10; box-shadow:0 4px 10px rgba(0,0,0,0.3); transition:background 0.3s; }
.nav-button.open { background:rgba(3,218,198,1); }

.tabs-wrapper { position:fixed; bottom:90px; left:0; width:100%; display:flex; justify-content:center; overflow:hidden; z-index:9; }
.tabs { display:flex; transition: transform 0.3s; will-change: transform; }
.tab { flex:0 0 auto; cursor:pointer; white-space:nowrap; border-radius:8px; margin:0 10px; transition: transform 0.3s, font-size 0.3s, color 0.3s; color:white; font-size:1em; text-align:center; }
.tab.active { color:#03dac6; font-weight:bold; font-size:1.3em; text-shadow:0 0 5px #03dac6; }
.tab-content ul { list-style:none; padding:0; margin:0; }
.tab-content li { margin:0.5em 0; }
.muted { color:#aaa; font-size:0.9em; }
</style>
</head>
<body>

<canvas id="matrixCanvas"></canvas>

<div class="overlay">
  <div class="content-wrapper">
    <div class="tab-content active" id="feed-de" data-tab="0"></div>
    <div class="tab-content" id="feed-int" data-tab="1"></div>
    <div class="tab-content" id="feed-tech" data-tab="2"></div>
    <div class="tab-content" id="feed-media" data-tab="3"></div>
  </div>

  <div class="nav-button" id="navButton">☰</div>

  <div class="tabs-wrapper" id="tabsWrapper" style="display:none;">
    <div class="tabs" id="tabs"></div>
  </div>
</div>

<script>
// Matrix Regen
const canvas=document.getElementById('matrixCanvas'), ctx=canvas.getContext('2d');
function resizeCanvas(){canvas.width=window.innerWidth; canvas.height=window.innerHeight;}
window.addEventListener('resize', resizeCanvas); resizeCanvas();
const letters='ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-=+/<>*', fontSize=16;
let columns=Math.floor(canvas.width/fontSize), drops=Array(columns).fill(1);
function drawMatrix(){
  ctx.fillStyle='rgba(0,0,0,0.05)'; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle='#0f0'; ctx.font=fontSize+'px monospace';
  for(let i=0;i<drops.length;i++){
    const text=letters.charAt(Math.floor(Math.random()*letters.length));
    ctx.fillText(text,i*fontSize,drops[i]*fontSize);
    if(drops[i]*fontSize>canvas.height && Math.random()>0.975) drops[i]=0;
    drops[i]++;
  }
}
setInterval(drawMatrix,35);

// Feeds
const FEEDS={
  "feed-de":["https://feeds.streich3r.org/feed?url=https://www.tagesschau.de/inland/index~rss2.xml","https://feeds.streich3r.org/feed?url=https://www.sueddeutsche.de/rss"],
  "feed-int":["https://feeds.streich3r.org/feed?url=https://www.srf.ch/news/bnf/rss/1922","https://feeds.streich3r.org/feed?url=https://www.nzz.ch/international.rss"],
  "feed-tech":["https://feeds.streich3r.org/feed?url=https://www.srf.ch/bnf/rss/19920122","https://feeds.streich3r.org/feed?url=https://www.nzz.ch/technologie.rss"],
  "feed-media":["https://feeds.streich3r.org/feed?url=https://www.nzz.ch/feuilleton.rss","https://feeds.streich3r.org/feed?url=https://www.derbund.ch/arc/outboundfeeds/rss/category/medien"]
};
const CONTENT_IDS = ["feed-de","feed-int","feed-tech","feed-media"];

// Tabs setup
const tabNames = ["Deutschland","International","Technik","Medien"];
const tabsContainer = document.getElementById('tabs');
const tabsWrapper = document.getElementById('tabsWrapper');
let repeatedTabs=[]; const repeatCount=7;

// repeat tabs für endlos scroll
for(let i=0;i<repeatCount;i++){
  tabNames.forEach((name,index)=>{
    const t=document.createElement('div');
    t.className='tab';
    t.dataset.index=index;
    t.innerText=name;
    tabsContainer.appendChild(t);
    repeatedTabs.push(t);
  });
}

const navButton=document.getElementById('navButton');
let tabsVisible=false;
function showTabs(show){
  tabsVisible=show;
  tabsWrapper.style.display=show?'flex':'none';
  navButton.classList.toggle('open',show);
  updateTabsTransform();
}
navButton.addEventListener('click',()=>{ showTabs(!tabsVisible); });

// Active management & feed load
repeatedTabs.forEach(tab=>{
  tab.addEventListener('click',()=>{
    const idx=parseInt(tab.dataset.index);
    // mark active tab
    repeatedTabs.forEach(t=>t.classList.remove('active'));
    tab.classList.add('active');
    // show content
    CONTENT_IDS.forEach(c=>document.getElementById(c).classList.remove('active'));
    const content=document.getElementById(CONTENT_IDS[idx]);
    content.classList.add('active');
    // load feed
    content.innerHTML="<p class='muted'>Lade Feed…</p>";
    function tryLoad(urls,attempt=0){
      if(!urls[attempt]){ content.innerHTML="<p class='muted'>Feed konnte nicht geladen werden.</p>"; return; }
      fetch(urls[attempt]).then(r=>r.json()).then(data=>{
        const items=Array.isArray(data.items)?data.items:[];
        if(items.length) content.innerHTML = renderItems(items);
        else tryLoad(urls,attempt+1);
      }).catch(()=>tryLoad(urls,attempt+1));
    }
    tryLoad(FEEDS[CONTENT_IDS[idx]]);
    // close nav
    showTabs(false);
    centerTab(tab);
  });
});

function renderItems(items){
  let html="<ul>";
  items.slice(0,12).forEach(item=>{
    const title=item.title||"Kein Titel", link=item.link||"#", date=item.pubDate||item.isoDate||"";
    const dateHtml=date?`<div class='muted'>${new Date(date).toLocaleString()}</div>`:"";
    html+=`<li><a href="${link}" target="_blank">${title}</a>${dateHtml}</li>`;
  });
  html+="</ul>"; return html;
}

// Center tab
function centerTab(tab){
  const containerCenter = window.innerWidth/2;
  const rect=tab.getBoundingClientRect();
  tabsWrapper.scrollLeft += rect.left + rect.width/2 - containerCenter;
  updateTabsTransform();
}

// 3D effect
function updateTabsTransform(){
  const containerCenter = window.innerWidth/2;
  repeatedTabs.forEach(tab=>{
    const rect = tab.getBoundingClientRect();
    const tabCenter = rect.left + rect.width/2;
    const distance = tabCenter - containerCenter;
    const scale = Math.max(0.6, 1 - Math.abs(distance)/300);
    const rotateY = distance/20;
    tab.style.transform = `perspective(600px) rotateY(${rotateY}deg) scale(${scale})`;
  });
}

// Touch scroll
let isDown=false, startX, scrollLeft;
tabsWrapper.addEventListener('mousedown', e=>{ isDown=true; startX=e.pageX; scrollLeft=tabsWrapper.scrollLeft; });
tabsWrapper.addEventListener('mouseup', ()=>isDown=false);
tabsWrapper.addEventListener('mouseleave', ()=>isDown=false);
tabsWrapper.addEventListener('mousemove', e=>{ if(!isDown) return; e.preventDefault(); tabsWrapper.scrollLeft=scrollLeft+(startX-e.pageX); updateTabsTransform(); });
tabsWrapper.addEventListener('touchstart', e=>{ isDown=true; startX=e.touches[0].pageX; scrollLeft=tabsWrapper.scrollLeft; });
tabsWrapper.addEventListener('touchend', ()=>isDown=false);
tabsWrapper.addEventListener('touchmove', e=>{ if(!isDown) return; tabsWrapper.scrollLeft=scrollLeft+(startX-e.touches[0].pageX); updateTabsTransform(); });

// Initial position: Deutschland mittig
window.addEventListener('load', ()=>{
  const firstTab = repeatedTabs.find(t=>t.dataset.index==0);
  centerTab(firstTab);
  firstTab.classList.add('active');
  document.getElementById("feed-de").classList.add('active');
});
window.addEventListener('resize', updateTabsTransform);
</script>
</body>
</html>
