<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>News mit Matrix + 3D Tabs Endless</title>
<style>
body { margin:0; font-family:sans-serif; height:100vh; overflow:hidden; background:#000; }
canvas#matrixCanvas { position:fixed; top:0; left:0; width:100%; height:100%; z-index:0; background:black; }

.overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(18,18,18,0.85); backdrop-filter:blur(2px); z-index:1; display:flex; flex-direction:column; justify-content:flex-end; }
.content-wrapper { flex-grow:1; display:flex; overflow:hidden; }
.tab-content { flex:0 0 100%; overflow-y:auto; padding:12em 1em 12em 1em; box-sizing:border-box; display:none; }
.tab-content.active { display:block; }

a { color:#03a9f4; text-decoration:none; display:block; margin:0.5em 0; }
a:hover { text-decoration:underline; }

.nav-button { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); width:60px; height:60px; border-radius:50%; background:rgba(3,218,198,0.7); display:flex; align-items:center; justify-content:center; cursor:pointer; z-index:10; box-shadow:0 4px 10px rgba(0,0,0,0.3); transition: background 0.3s; }
.nav-button.open { background: rgba(3,218,218,1); }

.tabs {
  position:fixed;
  bottom:-70px;
  left:0;
  width:100%;
  height:60px;
  display:flex;
  justify-content:center;
  align-items:center;
  overflow:hidden;
  background:rgba(30,30,30,0.8);
  border-top:2px solid #03dac6;
  transition:bottom 0.4s ease;
  z-index:9;
}
.tabs.show { bottom:90px; }

.tab-container { display:flex; align-items:center; transition: transform 0.2s ease; will-change: transform; }
.tab { flex:0 0 auto; padding:0.5em 1em; cursor:pointer; white-space:nowrap; border-radius:8px; margin:0 5px; transition: transform 0.2s, color 0.2s; color:white; transform-origin:center bottom; }
.tab.active { color:#03dac6; font-weight:bold; }

.tab-content ul { list-style:none; padding:0; margin:0; }
.tab-content li { margin:0.5em 0; }
.muted { color:#aaa; font-size:0.9em; }
</style>
</head>
<body>

<canvas id="matrixCanvas"></canvas>

<div class="overlay">
  <div class="content-wrapper">
    <div class="tab-content active" data-tab="0" id="feed-de"></div>
    <div class="tab-content" data-tab="1" id="feed-int"></div>
    <div class="tab-content" data-tab="2" id="feed-tech"></div>
    <div class="tab-content" data-tab="3" id="feed-media"></div>
  </div>

  <div class="nav-button" id="navButton">☰</div>

  <div class="tabs" id="tabs">
    <div class="tab-container" id="tabContainer">
      <!-- Tabs werden dynamisch geklont für unendliches Scrollen -->
    </div>
  </div>
</div>

<script>
// Matrix Regen
const canvas=document.getElementById('matrixCanvas'),ctx=canvas.getContext('2d');
function resizeCanvas(){canvas.width=window.innerWidth; canvas.height=window.innerHeight;}
window.addEventListener('resize',resizeCanvas); resizeCanvas();
const letters='ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-=+/<>*',fontSize=16;
let columns=Math.floor(canvas.width/fontSize),drops=Array(columns).fill(1);
function drawMatrix(){
  ctx.fillStyle='rgba(0,0,0,0.05)'; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle='#0f0'; ctx.font=fontSize+'px monospace';
  for(let i=0;i<drops.length;i++){
    const text=letters.charAt(Math.floor(Math.random()*letters.length));
    ctx.fillText(text,i*fontSize,drops[i]*fontSize);
    if(drops[i]*fontSize>canvas.height && Math.random()>0.975) drops[i]=0;
    drops[i]++;
  }
}
setInterval(drawMatrix,35);

// Feeds
const FEEDS={
  "feed-de":[
    "https://feeds.streich3r.org/feed?url=https://www.tagesschau.de/inland/index~rss2.xml",
    "https://feeds.streich3r.org/feed?url=https://www.sueddeutsche.de/rss"
  ],
  "feed-int":[
    "https://feeds.streich3r.org/feed?url=https://www.srf.ch/news/bnf/rss/1922",
    "https://feeds.streich3r.org/feed?url=https://www.nzz.ch/international.rss"
  ],
  "feed-tech":[
    "https://feeds.streich3r.org/feed?url=https://www.srf.ch/bnf/rss/19920122",
    "https://feeds.streich3r.org/feed?url=https://www.nzz.ch/technologie.rss"
  ],
  "feed-media":[
    "https://feeds.streich3r.org/feed?url=https://www.nzz.ch/feuilleton.rss",
    "https://feeds.streich3r.org/feed?url=https://www.derbund.ch/arc/outboundfeeds/rss/category/medien"
  ]
};

function renderItems(items){
  let html="<ul>";
  items.slice(0,12).forEach(item=>{
    const title=item.title||"Kein Titel",link=item.link||"#",date=item.pubDate||item.isoDate||"";
    const dateHtml=date?`<div class="muted">${new Date(date).toLocaleString()}</div>`:"";
    html+=`<li><a href="${link}" target="_blank" rel="noopener">${title}</a>${dateHtml}</li>`;
  });
  html+="</ul>"; return html;
}

function loadFeed(containerId,urls){
  const el=document.getElementById(containerId);
  el.innerHTML="<p class='muted'>Lade Feed…</p>";
  let attempt=0;
  function tryLoad(){
    if(!urls[attempt]) { el.innerHTML="<p class='muted'>Feed konnte nicht geladen werden.</p>"; return; }
    fetch(urls[attempt])
      .then(res=>res.json())
      .then(data=>{
        const items=Array.isArray(data.items)?data.items:[];
        if(items.length) el.innerHTML=renderItems(items);
        else { attempt++; tryLoad(); }
      })
      .catch(()=>{ attempt++; tryLoad(); });
  }
  tryLoad();
}

// Tabs & Nav
const navButton=document.getElementById('navButton');
const tabsBar=document.getElementById('tabs');
const tabContainer=document.getElementById('tabContainer');
let tabsVisible=false;

// Original Tabs
const originalTabs=[
  {label:'Deutschland', feed:'feed-de'},
  {label:'International', feed:'feed-int'},
  {label:'Technik', feed:'feed-tech'},
  {label:'Medien', feed:'feed-media'}
];

// Unendlich Scroll: 3x clone
const allTabs = [];
for(let i=0;i<3;i++){
  originalTabs.forEach((t,idx)=>{
    const tab = document.createElement('div');
    tab.classList.add('tab');
    tab.dataset.index = idx;
    tab.textContent = t.label;
    tabContainer.appendChild(tab);
    allTabs.push(tab);
  });
}
let activeIndex = 0;
const tabs = allTabs;
const contents=document.querySelectorAll('.tab-content');

// Start: Deutschland
tabs[originalTabs.length].classList.add('active'); // mittlere Kopie
contents[0].classList.add('active');
loadFeed('feed-de',FEEDS['feed-de']);
centerActiveTab();

// Show/hide Navbar
function showTabs(show){
  tabsVisible=show;
  tabsBar.classList.toggle('show',show);
  navButton.classList.toggle('open',show);
  if(show) updateCarousel();
}
navButton.addEventListener('click',()=>{ showTabs(!tabsVisible); });

// Click Tab
tabs.forEach((tab,i)=>{
  tab.addEventListener('click',()=>{
    const idx = parseInt(tab.dataset.index);
    updateActiveTab(idx);
    showTabs(false);
  });
});

function updateActiveTab(idx){
  tabs.forEach(t=>t.classList.remove('active'));
  tabs.filter(t=>parseInt(t.dataset.index)===idx).forEach(t=>t.classList.add('active'));
  contents.forEach(c=>c.classList.remove('active'));
  contents[idx].classList.add('active');
  loadFeed(contents[idx].id,FEEDS[contents[idx].id]);
  activeIndex=idx;
  updateCarousel();
}

// Carousel 3D
function updateCarousel(){
  const centerX = tabsBar.clientWidth / 2;
  tabs.forEach((tab,i)=>{
    const tabRect = tab.getBoundingClientRect();
    const tabCenter = tabRect.left + tabRect.width/2 - tabsBar.getBoundingClientRect().left;
    const offset = (tabCenter - centerX)/150;
    const scale = Math.max(0.6,1-Math.abs(offset)/3);
    const rotateY = offset*25;
    tab.style.transform = `perspective(600px) translateZ(${(scale-1)*50}px) scale(${scale}) rotateY(${rotateY}deg)`;
  });
  centerActiveTab();
}

// Center active tab in middle clone
function centerActiveTab(){
  const centerTab = tabs.find(t=>t.classList.contains('active'));
  const tabsRect = tabsBar.getBoundingClientRect();
  const tabRect = centerTab.getBoundingClientRect();
  const offset = tabRect.left - tabsRect.left - tabsRect.width/2 + tabRect.width/2;
  tabContainer.style.transform = `translateX(${-offset}px)`;
}

// Swipe
let startX=0,startTransform=0;
tabsBar.addEventListener('touchstart',e=>{
  startX=e.touches[0].clientX;
  startTransform=parseFloat(tabContainer.style.transform.replace('translateX(','').replace('px)',''))||0;
});
tabsBar.addEventListener('touchmove',e=>{
  const dx = e.touches[0].clientX - startX;
  tabContainer.style.transform = `translateX(${startTransform + dx}px)`;
  updateCarousel();
});
</script>
</body>
</html>
